---
import ProjectCard from "@/components/ProjectCard.astro";
import Base from "@/layouts/Base.astro";
import { getListPage, getSinglePage } from "@/lib/contentParser.astro";
import { sortByDate } from "@/lib/utils/sortFunctions";
import PageHeader from "@/partials/PageHeader.astro";

const AWARDS_FOLDER = "awards";

const awardsIndex = await getListPage(AWARDS_FOLDER, "-index");
if (awardsIndex.data.draft) {
  return Astro.redirect("/404");
}

const awards = await getSinglePage(AWARDS_FOLDER);
const sortedAwards = sortByDate(awards);
const majorAwards = sortedAwards.filter((a) =>
  a.data.categories?.includes("Major Awards"),
);
const otherAwards = sortedAwards.filter(
  (a) => !a.data.categories?.includes("Major Awards"),
);
---

<Base
  title={awardsIndex.data.title}
  meta_title={awardsIndex.data.meta_title}
  image={awardsIndex.data.image}
  description={awardsIndex.data.description}
>
  <PageHeader title={awardsIndex?.data.title} />
  <section class="section">
    <div class="container">
      <!-- Major Awards -->
      {
        majorAwards.length > 0 && (
          <div class="mb-16">
            <h2 class="mb-8 text-center text-2xl font-bold">Major Awards</h2>
            <div class="row">
              {majorAwards.map((award) => (
                <div class="mb-14 md:col-6 lg:col-4">
                  <ProjectCard data={award} basePath="awards" />
                </div>
              ))}
            </div>
          </div>
        )
      }

      <!-- Other Awards -->
      {
        otherAwards.length > 0 && (
          <div>
            <h2 class="mb-8 text-center text-2xl font-bold">
              Other Awards & Recognition
            </h2>
            <div class="row">
              {otherAwards.map((award) => (
                <div class="mb-14 md:col-6 lg:col-4">
                  <ProjectCard data={award} basePath="awards" />
                </div>
              ))}
            </div>
          </div>
        )
      }
    </div>
  </section>
</Base>
