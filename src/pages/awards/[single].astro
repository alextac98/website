---
import Base from "@/layouts/Base.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import dateFormat from "@/lib/utils/dateFormat";
import { markdownify } from "@/lib/utils/textConverter";
import { render } from "astro:content";
import type { GetStaticPaths } from "astro";
import ImageMod from "@/components/ImageMod.astro";
import type { CollectionEntry } from "astro:content";

export const getStaticPaths: GetStaticPaths = async () => {
  const awards = await getSinglePage("awards");
  return awards.map((award) => ({
    params: { single: award.id },
    props: { award },
  }));
};

interface Props {
  award: CollectionEntry<"awards">;
}

const { award } = Astro.props;
const { Content } = await render(award);
const {
  title,
  meta_title,
  description,
  image,
  date,
  categories,
  tags,
  show_image,
} = award.data;
---

<Base
  title={title}
  meta_title={meta_title}
  description={description}
  image={image}
>
  <section class="section pt-7">
    <div class="container">
      <div class="row justify-center">
        <article class="lg:col-10">
          {
            image && show_image && (
              <div class="mb-10">
                <ImageMod
                  src={image}
                  height={500}
                  width={1200}
                  alt={title}
                  class="w-full rounded-lg"
                  format="webp"
                />
              </div>
            )
          }

          <h1 set:html={markdownify(title)} class="h2 mb-4" />

          <div
            class="mb-6 flex flex-wrap items-center gap-4 text-sm text-text-light dark:text-darkmode-text-light"
          >
            {date && <span>{dateFormat(date, "MMMM d, yyyy")}</span>}

            {
              categories && categories.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {categories.map((category: string) => (
                    <span class="rounded bg-light px-2 py-1 dark:bg-darkmode-light">
                      {category}
                    </span>
                  ))}
                </div>
              )
            }
          </div>

          {
            tags && tags.length > 0 && (
              <div class="mb-8 flex flex-wrap gap-2">
                {tags.map((tag: string) => (
                  <a
                    href={`/tags/${tag.toLowerCase().replace(/\s+/g, "-")}`}
                    class="rounded-full bg-primary/10 px-3 py-1 text-sm text-primary hover:bg-primary/20 dark:bg-darkmode-primary/10 dark:text-darkmode-primary dark:hover:bg-darkmode-primary/20"
                  >
                    #{tag}
                  </a>
                ))}
              </div>
            )
          }

          <div class="content mb-10">
            <Content />
          </div>

          <div
            class="mt-8 border-t border-border pt-8 dark:border-darkmode-border"
          >
            <a href="/awards" class="btn btn-outline-primary">
              ‚Üê Back to Awards
            </a>
          </div>
        </article>
      </div>
    </div>
  </section>
</Base>
