---
import ImageMod from "@/components/ImageMod.astro";
import {
  Swiper,
  SwiperButtonNext,
  SwiperButtonPrev,
  SwiperPagination,
  SwiperSlide,
  SwiperWrapper,
} from "astro-swiper";

interface Image {
  src: string;
  alt?: string;
  caption?: string;
}

interface Props {
  images: Image[];
  autoplay?: boolean;
  loop?: boolean;
  height?: string;
}

const { images, autoplay = false, loop = true, height = "400px" } = Astro.props;

const galleryId = `gallery-${Math.random().toString(36).substring(2, 9)}`;

const swiperOptions = {
  spaceBetween: 16,
  loop,
  ...(autoplay && {
    autoplay: {
      delay: 3000,
      disableOnInteraction: true,
    },
  }),
  navigation: {
    nextEl: `.${galleryId}-next`,
    prevEl: `.${galleryId}-prev`,
  },
  pagination: {
    el: `.${galleryId}-pagination`,
    type: "bullets" as const,
    clickable: true,
    dynamicBullets: false,
  },
};
---

<div class="image-gallery my-8">
  <Swiper options={swiperOptions} class="rounded-lg overflow-hidden">
    <SwiperWrapper>
      {images.map((image) => (
        <SwiperSlide>
          <div class="flex flex-col items-center h-full">
            <div class="flex-1 flex items-center justify-center overflow-hidden" style={`height: ${height};`}>
              <ImageMod
                src={image.src}
                alt={image.alt || "Gallery image"}
                width={800}
                height={600}
                class="max-w-full max-h-full rounded-lg object-contain"
                format="webp"
              />
            </div>
            {image.caption && (
              <p class="mt-3 text-center text-sm text-gray-600 dark:text-gray-400 italic">
                {image.caption}
              </p>
            )}
          </div>
        </SwiperSlide>
      ))}
    </SwiperWrapper>
    <div class="flex items-center justify-center gap-4 mt-4">
      <SwiperButtonPrev
        class={`${galleryId}-prev cursor-pointer p-2 rounded-full bg-light dark:bg-darkmode-light hover:bg-primary hover:text-white dark:hover:bg-darkmode-primary transition-colors`}
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </SwiperButtonPrev>
      <SwiperButtonNext
        class={`${galleryId}-next cursor-pointer p-2 rounded-full bg-light dark:bg-darkmode-light hover:bg-primary hover:text-white dark:hover:bg-darkmode-primary transition-colors`}
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </SwiperButtonNext>
    </div>
    <SwiperPagination class={`${galleryId}-pagination flex items-center justify-center mt-4`} />
  </Swiper>
</div>
